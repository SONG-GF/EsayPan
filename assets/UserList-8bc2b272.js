import{_ as K,a as E,u as H,b as P,r as d,e as o,f as x,h as k,i as _,j as e,w as a,q as C,p as G,m as f,t as b,A as V,l as D,n as J}from"./index-28ee92df.js";const Q={class:"top-panel"},W={class:"file-list"},X={class:"avatar"},Y={key:0,style:{color:"#529b2e"}},Z={key:1,style:{color:"#f56c6c"}},ee=["onClick"],te=["onClick"],ae={__name:"UserList",setup(se){const{proxy:u}=E();H(),P();const S={loadDataList:"/admin/loadUserList",updateUserStatus:"/admin/updateUserStatus",updateUserSpace:"/admin/updateUserSpace"},N=[{label:"头像",prop:"avatar",width:80,scopedSlots:"avatar"},{label:"昵称",prop:"nickName"},{label:"邮箱",prop:"email"},{label:"空间使用",prop:"space",scopedSlots:"space"},{label:"加入时间",prop:"joinTime"},{label:"最后登录时间",prop:"lastLoginTime"},{label:"状态",prop:"status",scopedSlots:"status",width:80},{label:"操作",prop:"op",width:150,scopedSlots:"op"}],r=d({}),m=d({}),z={extHeight:20},c=async()=>{let s={pageNo:m.value.pageNo,pageSize:m.value.pageSize};Object.assign(s,r.value);let t=await u.Request({url:S.loadDataList,params:s});t&&(m.value=t.data)},L=s=>{u.Confirm(`你确定要【${s.status==0?"启动":"禁用"}】吗？`,async()=>{await u.Request({url:S.updateUserStatus,params:{userId:s.userId,status:s.status==0?1:0}})&&c()})},i=d({show:!1,title:"修改空间大小",buttons:[{type:"primary",text:"确定",click:s=>{R()}}]}),p=d({}),h=d(),q={changeSpace:[{required:!0,message:"请输入空间大小"}]},I=s=>{i.value.show=!0,J(()=>{h.value.resetFields(),p.value=Object.assign({},s)})},R=()=>{h.value.validate(async s=>{if(!s)return;let t={};Object.assign(t,p.value),await u.Request({url:S.updateUserSpace,params:t})&&(i.value.show=!1,u.Message.success("操作成功"),c())})};return(s,t)=>{const g=o("el-input"),v=o("el-form-item"),y=o("el-col"),w=o("el-option"),T=o("el-select"),j=o("el-button"),F=o("el-row"),U=o("el-form"),A=o("Avatar"),B=o("el-divider"),M=o("Table"),O=o("Dialog");return x(),k("div",null,[_("div",Q,[e(U,{model:r.value,"label-width":"80px",onSubmit:t[2]||(t[2]=C(()=>{},["prevent"]))},{default:a(()=>[e(F,null,{default:a(()=>[e(y,{span:4},{default:a(()=>[e(v,{label:"用户昵称"},{default:a(()=>[e(g,{clearable:"",placeholder:"支持模糊搜索",modelValue:r.value.nickNameFuzzy,"onUpdate:modelValue":t[0]||(t[0]=n=>r.value.nickNameFuzzy=n),modelModifiers:{trim:!0},onKeyup:G(c,["native"])},null,8,["modelValue","onKeyup"])]),_:1})]),_:1}),e(y,{span:4},{default:a(()=>[e(v,{label:"状态"},{default:a(()=>[e(T,{clearable:"",placeholder:"请选择状态",modelValue:r.value.status,"onUpdate:modelValue":t[1]||(t[1]=n=>r.value.status=n)},{default:a(()=>[e(w,{value:1,label:"启用"}),e(w,{value:0,label:"禁用"})]),_:1},8,["modelValue"])]),_:1})]),_:1}),e(y,{span:4,style:{"padding-left":"10px"}},{default:a(()=>[e(j,{type:"primary",onClick:c},{default:a(()=>[f(" 查询 ")]),_:1})]),_:1})]),_:1})]),_:1},8,["model"])]),_("div",W,[e(M,{columns:N,showPagination:!0,dataSource:m.value,fetch:c,options:z},{avatar:a(({index:n,row:l})=>[_("div",X,[e(A,{userId:l.userId,avatar:l.qqAvatar},null,8,["userId","avatar"])])]),space:a(({index:n,row:l})=>[f(b(V(u).Utils.size2Str(l.useSpace))+"/"+b(V(u).Utils.size2Str(l.totalSpace)),1)]),status:a(({index:n,row:l})=>[l.status==1?(x(),k("span",Y,"启用")):D("",!0),l.status==0?(x(),k("span",Z,"禁用")):D("",!0)]),op:a(({index:n,row:l})=>[_("span",{class:"a-link",onClick:$=>I(l)},"分配空间",8,ee),e(B,{direction:"vertical"}),_("span",{class:"a-link",onClick:$=>L(l)},b(l.status==0?"启用":"禁用"),9,te)]),_:1},8,["dataSource"])]),e(O,{show:i.value.show,title:i.value.title,buttons:i.value.buttons,width:"400px",showCancel:!1,onClose:t[5]||(t[5]=n=>i.value.show=!1)},{default:a(()=>[e(U,{model:p.value,rules:q,ref_key:"formDataRef",ref:h,"label-width":"80px",onSubmit:t[4]||(t[4]=C(()=>{},["prevent"]))},{default:a(()=>[e(v,{label:"昵称"},{default:a(()=>[f(b(p.value.nickName),1)]),_:1}),e(v,{label:"空间大小",prop:"changeSpace"},{default:a(()=>[e(g,{clearable:"",placeholder:"请输入空间大小",modelValue:p.value.changeSpace,"onUpdate:modelValue":t[3]||(t[3]=n=>p.value.changeSpace=n)},{suffix:a(()=>[f("MB")]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["show","title","buttons"])])}}},oe=K(ae,[["__scopeId","data-v-ad38efaa"]]);export{oe as default};
