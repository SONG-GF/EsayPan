import{_ as se,a as ae,u as te,b as oe,r as c,e as r,G as ne,f as o,h as d,i as s,H as le,F as M,j as _,t as v,k as y,w as I,A as P,m as z,l as m,s as ie,v as ce}from"./index-28ee92df.js";const w=S=>(ie("data-v-e60f2f74"),S=S(),ce(),S),re={class:"share"},de=w(()=>s("span",{class:"iconfont icon-pan"},null,-1)),ue=w(()=>s("span",{class:"name"},"云享盘",-1)),he=[de,ue],pe={class:"share-body"},fe={key:0,class:"loading"},_e={class:"share-panel"},ve={class:"share-user-info"},ye={class:"avatar"},me={class:"share-info"},Se={class:"user-info"},ge={class:"nick-name"},ke={class:"share-time"},Ie={class:"file-name"},we={class:"share-op-btn"},Ce=w(()=>s("span",{class:"iconfont icon-cancel"},null,-1)),Fe=w(()=>s("span",{class:"iconfont icon-import"},null,-1)),be={class:"file-list"},Ne=["onMouseenter","onMouseleave"],Te=["title"],Re=["onClick"],xe={class:"op"},De=["onClick"],Me=["onClick"],Pe={key:0},ze={__name:"Share",setup(S){const{proxy:n}=ae(),h=te(),C=oe(),u={getShareLoginInfo:"/showShare/getShareLoginInfo",loadFileList:"/showShare/loadFileList",createDownloadUrl:"/showShare/createDownloadUrl",download:"/api/showShare/download",cancelShare:"/share/cancelShare",saveShare:"/showShare/saveShare"},i=C.params.shareId,l=c({});(async()=>{let e=await n.Request({url:u.getShareLoginInfo,showLoading:!1,params:{shareId:i}});if(e){if(e.data==null){h.push("/shareCheck/"+i);return}l.value=e.data}})();const L=[{label:"文件名",prop:"fileName",scopedSlots:"fileName"},{label:"修改时间",prop:"lastUpdateTime",width:200},{label:"大小",prop:"fileSize",scopedSlots:"fileSize",width:200}],p=c({}),O={extHeight:80,selectType:"checkbox"},F=async()=>{let e={pageNo:p.value.pageNo,pageSize:p.value.pageSize,shareId:i,filePid:T.value.fileId},t=await n.Request({url:u.loadFileList,params:e});t&&(p.value=t.data)},U=e=>{p.value.list.forEach(t=>{t.showOp=!1}),e.showOp=!0},V=e=>{e.showOp=!1},f=c([]),j=e=>{f.value=[],e.forEach(t=>{f.value.push(t.fileId)})},T=c({fileId:0}),q=e=>{const{curFolder:t}=e;T.value=t,F()},R=c(),x=c(),$=e=>{if(e.folderType==1){x.value.openFolder(e);return}e.shareId=i,R.value.showPreview(e,2)},A=async e=>{let t=await n.Request({url:u.createDownloadUrl+"/"+i+"/"+e});t&&(window.location.href=u.download+"/"+t.data)},g=c(),b=[],B=()=>{if(f.value.length!=0){if(!n.VueCookies.get("userInfo")){h.push("/login?redirectUrl="+C.path);return}b.values=f.value,g.value.showFolderDialog()}},E=e=>{if(!n.VueCookies.get("userInfo")){h.push("/login?redirectUrl="+C.path);return}b.values=[e.fileId],g.value.showFolderDialog()},H=async e=>{await n.Request({url:u.saveShare,params:{shareId:i,shareFileIds:b.values.join(","),myFolderId:e}})&&(F(),n.Message.success("保存成功"),g.value.close())},G=()=>{n.Confirm("你确定要取消分享吗？",async()=>{await n.Request({url:u.cancelShare,params:{shareIds:i}})&&(n.Message.success("取消分享成功"),h.push("/"))})},J=()=>{h.push("/")};return(e,t)=>{const K=r("Avatar"),D=r("el-button"),Q=r("Navigation"),N=r("icon"),W=r("Table"),X=r("FolderSelect"),Y=r("Preview"),Z=ne("loading");return o(),d("div",re,[s("div",{class:"header"},[s("div",{class:"header-content"},[s("div",{class:"logo",onClick:J},he)])]),s("div",pe,[Object.keys(l.value).length==0?le((o(),d("div",fe,null,512)),[[Z,Object.keys(l.value).length==0]]):(o(),d(M,{key:1},[s("div",_e,[s("div",ve,[s("div",ye,[_(K,{userId:l.value.userId,avatar:l.value.avatar,width:50},null,8,["userId","avatar"])]),s("div",me,[s("div",Se,[s("span",ge,v(l.value.nickName),1),s("span",ke,"分享于 "+v(l.value.shareTime),1)]),s("div",Ie,"分享文件："+v(l.value.fileName),1)])]),s("div",we,[l.value.currentUser?(o(),y(D,{key:0,type:"primary",onClick:G},{default:I(()=>[Ce,z("取消分享")]),_:1})):(o(),y(D,{key:1,type:"primary",disabled:f.value.length==0,onClick:B},{default:I(()=>[Fe,z("保存到我的网盘")]),_:1},8,["disabled"]))])]),_(Q,{ref_key:"navigationRef",ref:x,onNavChange:q,shareId:P(i)},null,8,["shareId"]),s("div",be,[_(W,{columns:L,showPagination:!0,dataSource:p.value,fetch:F,initFetch:!1,options:O,showPageSize:!1,onRowSelected:j},{fileName:I(({index:ee,row:a})=>[s("div",{class:"file-item",onMouseenter:k=>U(a),onMouseleave:k=>V(a)},[(a.fileType==3||a.fileType==1)&&a.status!==0?(o(),y(N,{key:0,cover:a.fileCover},null,8,["cover"])):(o(),d(M,{key:1},[a.folderType==0?(o(),y(N,{key:0,fileType:a.fileType},null,8,["fileType"])):m("",!0),a.folderType==1?(o(),y(N,{key:1,fileType:0})):m("",!0)],64)),s("span",{class:"file-name",title:a.fileName},[s("span",{onClick:k=>$(a)},v(a.fileName),9,Re)],8,Te),s("span",xe,[a.folderType==0?(o(),d("span",{key:0,class:"iconfont icon-download",onClick:k=>A(a.fileId)},"下载",8,De)):m("",!0),a.showOp&&!l.value.currentUser?(o(),d("span",{key:1,class:"iconfont icon-import",onClick:k=>E(a)},"保存到我的网盘",8,Me)):m("",!0)])],40,Ne)]),fileSize:I(({index:ee,row:a})=>[a.fileSize?(o(),d("span",Pe,v(P(n).Utils.size2Str(a.fileSize)),1)):m("",!0)]),_:1},8,["dataSource"])])],64)),_(X,{ref_key:"folderSelectRef",ref:g,onFolderSelect:H},null,512),_(Y,{ref_key:"previewRef",ref:R},null,512)])])}}},Ue=se(ze,[["__scopeId","data-v-e60f2f74"]]);export{Ue as default};
